<UserControl x:Class="TimeStudiesWpf.Controls.DefinitionEditorControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:TimeStudiesWpf.Controls"
             xmlns:models="clr-namespace:TimeStudiesWpf.Models"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             Loaded="UserControl_Loaded">
    <UserControl.Resources>
        <local:LocalizeConverter x:Key="LocalizeConverter"/>
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <ObjectDataProvider x:Key="DimensionTypes" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="models:DimensionType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </UserControl.Resources>
    <Grid Margin="{StaticResource MarginMedium}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Label x:Name="HeaderLabel"
               Grid.Row="0"
               Style="{StaticResource HeaderLabelStyle}"/>

        <!-- Definition Info -->
        <GroupBox Grid.Row="1"
                  Margin="{StaticResource MarginNormal}"
                  Padding="{StaticResource PaddingMedium}">
            <GroupBox.Header>
                <Label x:Name="DefinitionInfoLabel"
                       FontWeight="SemiBold"/>
            </GroupBox.Header>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Label Grid.Row="0" Grid.Column="0"
                       x:Name="DefinitionNameLabel"
                       Style="{StaticResource LabelStyle}"/>
                <TextBox Grid.Row="0" Grid.Column="1"
                         x:Name="DefinitionNameTextBox"
                         Text="{Binding Definition.Name, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource TouchTextBoxStyle}"
                         Margin="{StaticResource MarginSmall}"
                         IsEnabled="{Binding IsEditingEnabled}"/>

                <Label Grid.Row="1" Grid.Column="0"
                       x:Name="DescriptionLabel"
                       Style="{StaticResource LabelStyle}"/>
                <TextBox Grid.Row="1" Grid.Column="1"
                         x:Name="DescriptionTextBox"
                         Text="{Binding Definition.Description, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource TouchTextBoxStyle}"
                         Margin="{StaticResource MarginSmall}"
                         IsEnabled="{Binding IsEditingEnabled}"/>
            </Grid>
        </GroupBox>

        <!-- Process Steps Grid -->
        <GroupBox Grid.Row="2"
                  Margin="{StaticResource MarginNormal}"
                  Padding="{StaticResource PaddingMedium}">
            <GroupBox.Header>
                <Label x:Name="ProcessStepLabel"
                       FontWeight="SemiBold"/>
            </GroupBox.Header>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Step Actions -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Left">
                    <Button x:Name="AddStepButton"
                            Style="{StaticResource TouchButtonStyle}"
                            Command="{Binding AddStepCommand}"
                            IsEnabled="{Binding IsEditingEnabled}"
                            Margin="{StaticResource MarginSmall}"/>
                    <Button x:Name="RemoveStepButton"
                            Style="{StaticResource OutlineButtonStyle}"
                            Command="{Binding RemoveStepCommand}"
                            IsEnabled="{Binding IsEditingEnabled}"
                            Margin="{StaticResource MarginSmall}"/>
                    <Button x:Name="MarkDefaultButton"
                            Style="{StaticResource OutlineButtonStyle}"
                            Command="{Binding MarkAsDefaultCommand}"
                            IsEnabled="{Binding IsEditingEnabled}"
                            Margin="{StaticResource MarginSmall}"/>
                </StackPanel>

                <!-- Process Steps DataGrid -->
                <DataGrid Grid.Row="1"
                          x:Name="ProcessStepsDataGrid"
                          ItemsSource="{Binding Definition.ProcessSteps}"
                          SelectedItem="{Binding SelectedProcessStep}"
                          Style="{StaticResource TouchDataGridStyle}"
                          ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          Margin="{StaticResource MarginSmall}">
                    <DataGrid.Columns>
                        <DataGridTextColumn x:Name="OrderNumberColumn"
                                            Binding="{Binding OrderNumber}"
                                            Width="80"
                                            IsReadOnly="{Binding IsLocked}"/>
                        <DataGridTextColumn x:Name="DescriptionColumn"
                                            Binding="{Binding Description}"
                                            Width="*"
                                            IsReadOnly="{Binding IsLocked}"/>
                        <DataGridTextColumn x:Name="ProductColumn"
                                            Binding="{Binding ProductDescription}"
                                            Width="120"
                                            IsReadOnly="{Binding IsLocked}"/>
                        <DataGridComboBoxColumn x:Name="DimensionTypeColumn"
                                               SelectedItemBinding="{Binding DimensionType}"
                                               ItemsSource="{Binding Source={StaticResource DimensionTypes}}"
                                               Width="100"
                                               IsReadOnly="{Binding IsLocked}"/>
                        <DataGridTextColumn x:Name="DimensionUnitColumn"
                                            Binding="{Binding DimensionUnit}"
                                            Width="70"
                                            IsReadOnly="{Binding IsLocked}"/>
                        <DataGridTextColumn x:Name="DefaultValueColumn"
                                            Binding="{Binding DefaultDimensionValue}"
                                            Width="80"
                                            IsReadOnly="{Binding IsLocked}"/>
                        <DataGridCheckBoxColumn x:Name="DefaultStepColumn"
                                                Binding="{Binding IsDefaultStep}"
                                                Width="80"
                                                IsReadOnly="{Binding IsLocked}"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="{StaticResource MarginNormal}">
            <Button x:Name="CreateCopyButton"
                    Style="{StaticResource TouchButtonStyle}"
                    Command="{Binding CreateCopyCommand}"
                    Visibility="{Binding IsLocked, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Margin="{StaticResource MarginSmall}"/>
            <Button x:Name="SaveButton"
                    Style="{StaticResource AccentButtonStyle}"
                    Command="{Binding SaveCommand}"
                    IsEnabled="{Binding CanSave}"
                    Margin="{StaticResource MarginSmall}"/>
            <Button x:Name="CancelButton"
                    Style="{StaticResource OutlineButtonStyle}"
                    Command="{Binding CancelCommand}"
                    Margin="{StaticResource MarginSmall}"/>
        </StackPanel>
    </Grid>
</UserControl>